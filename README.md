# Тестовое задание на позицию стажёра-бэкендера

## Микросервис для работы с балансом пользователей

**Задача:**

Необходимо реализовать микросервис для работы с балансом пользователей (зачисление средств, списание средств, перевод средств от пользователя к пользователю, а также метод получения баланса пользователя). Сервис должен предоставлять HTTP API и принимать/отдавать запросы/ответы в формате JSON.

**Основное задание**

Метод начисления средств на баланс. Принимает id пользователя и сколько средств зачислить.
Метод резервирования средств с основного баланса на отдельном счете. Принимает id пользователя, ИД услуги, ИД заказа, стоимость.
Метод признания выручки – списывает из резерва деньги, добавляет данные в отчет для бухгалтерии. Принимает id пользователя, ИД услуги, ИД заказа, сумму.
Метод получения баланса пользователя. Принимает id пользователя.

---
**Диаграмма классов**

![Диаграмма классов](img/Diagram.png)

---
**Решенные задачи**

1. Метод начисления средств на баланс. Принимает id пользователя и сколько средств зачислить.
2. Метод резервирования средств с основного баланса на отдельном счете. Принимает id пользователя, ИД услуги, ИД заказа, стоимость.
3. Метод признания выручки – списывает из резерва деньги, добавляет данные в отчет для бухгалтерии. Принимает id пользователя, ИД услуги, ИД заказа, сумму.
4. Метод получения баланса пользователя. Принимает id пользователя.

**Дополнительно**
- Добавлен метод rollback, с помощью которого можно удалить неподтвержденную операцию (деньги вернутся на баланс пользователя)

---
**Запуск**

После клонирования репозитория достаточно выполнить `make` в папке проекта
> Для завершения: `make clean`
> Для перезапуска: `make restart`

---
**Запросы**

- *Получение баланса пользователя*
```
curl http://localhost:8080/api/v1/balance/{user_id}
```

- *Пополнение баланса пользователя (создание нового с нужным балансом)*
```
curl  http://localhost:8080/api/v1/balance/{user_id}/credit -H 'Content-Type: application/json' -d '{"currency" : 0}'
```

- *Резервирование средств пользователя*
```
curl http://localhost:8080/api/v1/balance/{user_id}/reserve -H 'Content-Type: application/json' -d '{"service_id": "1","order_id": "1","currency": 0}' 
```

- *Признание выручки*
```
curl http://localhost:8080/api/v1/balance/{user_id}/commit -H 'Content-Type: application/json' -d '{"service_id": "string","order_id": "string","currency": 0}'
```

- *Возврат средств*
```
curl http://localhost:8080/api/v1/balance/{user_id}/rollback -H 'Content-Type: application/json' -d '{"service_id": "string","order_id": "string","currency": 0}'
```


